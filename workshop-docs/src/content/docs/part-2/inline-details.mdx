---
title: Inline Recipe Details
description: Display recipe details without page reloads
---

import { Steps, Aside } from '@astrojs/starlight/components';

When a user selects a recipe, they expect to see it without delay. Viewing another recipe should not require the back button.

Displaying recipe details inline on the page, without a separate page load, would be a big improvement.

**How?** Imagine you could send the selected recipe ID to the server, get back recipe details, and show the recipe in a second column.

:::note[Good news!]
The CSS already defines styles for flex-columns, called `navigation-panel` & `details-panel`. You will use these two styles to create a two-column layout for navigation and recipe details.
:::

## Implementation overview

<Steps>
1. Add the HTMX library
2. Add two-pane layout
3. Make recipe links dynamic
4. Create a recipe detail fragment
5. Return the fragment for HTMX requests
6. Fix formatting
</Steps>


## Step 1: Load HTMX library

The `layout` temlate is used by all pages, so it's a great place to load HTMX.

Open `templates/_layout.html` and add the script in the `<head>` section:

```html title="templates/_layout.html" ins={2-3}
<head>
    <!-- Add HTMX library -->
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js" integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz" crossorigin="anonymous"></script>
</head>
```

## Step 2: Add a two-pane layout

Replace the contents of `<body>` in `_layout.html` with the following HTML:

```html title="templates/_layout.html" ins={3-10} del={2}
<body>
{% block content %}{% endblock %}
<div class="container">
    <div id="recipe-navigation" class="navigation-panel">
        {% block content %}{% endblock %}
    </div>
    <div id="recipe-details" class="details-panel empty">
        <p>Select a recipe to view details</p>
    </div>
</div>
</body>
```

The previous two divs create a two-column layout:
- **Left column** (`recipe-navigation`): Recipe list
- **Right column** (`recipe-details`): Details panel with placeholder

## Step 3: Make Links Dynamic

Now, convert the recipe link that goes to recipe details for a recipe ID, to a dynamic call using hx- attributes:

Open `templates/_recipe_list_items.html` and find the recipe detail link:

```html title="Before - standard link"
<a href="{{ url_for('recipe_detail', recipe_id=recipe.index) }}">{{ recipe.index }} - {{ recipe.name }}</a>
```

Replace the `href` value with `#` and add HTMX attributes:

```html title="After - HTMX enhanced" ins={2-4} del={1}
<a href="{{ url_for('recipe_detail', recipe_id=recipe.index) }}"
<a href="#"
   hx-get="{{ url_for('recipe_detail', recipe_id=recipe.index) }}"
   hx-target="#recipe-details">
    {{ recipe.index }} - {{ recipe.name }}
</a>
```

**Refresh your browser and select a recipe!**

:::tip[Wow! Look what you did!]
You should already see **dynamic loading** of recipe details! The result isn't perfect, but we'll fix that in the next step.
:::

**How is this working?** The new recipe link invokes HTMX to handle the request. HTMX calls the server and puts the resulting HTML into the `target` div.

**One problem:** The server is still sending an **entire page**, wrapped in `_layout.html`. So you're getting extra HTML that you don't need. 

In the next step, you'll edit the server route to only send the HTML you need.

## Step 4: Create a recipe detail fragment

To send only the recipe details (without the full page layout), you need to extract the detail HTML into its own template fragment.

**Why a fragment?** Currently, `recipe.html` is a full page — it extends `_layout.html` and includes the `<head>`, navigation, etc. When HTMX requests recipe details, you only want the recipe content itself, not the entire page wrapper. By extracting the details into a fragment, you can:
- Return **just the fragment** for HTMX requests (fast, partial update)
- Include the fragment in `recipe.html` for regular full-page requests (no duplication)

Create a new file `templates/_recipe_detail_fragment.html` with the recipe detail content:

```html title="templates/_recipe_detail_fragment.html"
<h1>Recipe Details: {{ recipe.name }}</h1>
<img src="{{ recipe.get_thumbnail_image_url() }}" alt="{{ recipe.name }}" width="200" height="200">

<div class="recipe-meta">
    <p><strong>Author:</strong> {{ recipe.author }}</p>
    <p>{{ recipe.description }}</p>
</div>

<div class="section">
    <h2>Ingredients</h2>
    <ul class="ingredients">
        {% for ingredient in recipe.ingredients %}
        <li>{{ ingredient }}</li>
        {% endfor %}
    </ul>
</div>

<div class="section">
    <h2>Method</h2>
    <ol class="method">
        {% for step in recipe.method %}
        <li>{{ step }}</li>
        {% endfor %}
    </ol>
</div>

<div class="source">
    <p><a href="{{ recipe.url }}" target="_blank">View original recipe source</a></p>
</div>
```

Then update `templates/recipe.html` to include the fragment instead of duplicating the content:

```html title="templates/recipe.html" ins={3} del={4}
{% block content %}

{% include "_recipe_detail_fragment.html" %}
(previous recipe detail HTML — now replaced by the include)

<hr/>
<div class="back-link">
    <a href="{{ url_for('home') }}">Back to Recipe List</a>
</div>
{% endblock %}
```

## Step 5: Return the fragment for HTMX requests

Update your server to only return partial HTML for HTMX requests.

For requests from HTMX, the **HX-Request** header is present. With that info, your server action can choose a different template — in this case, only the HTML produced by `_recipe_detail_fragment`.

Open `app.py` and add the following header check **before** the return statement in `recipe_detail()`:

```python title="app.py" ins={2-3}
def recipe_detail(recipe_id):
    if request.headers.get('HX-Request'):
        return render_template('_recipe_detail_fragment.html', recipe=recipe)
    return render_template('recipe.html', recipe=recipe)
```
Reload to check it out. You might need to Stop and restart the server. 

## Step 6: Fix formatting

One problem you might notice. The CSS applies the same **centered** style when the details panel were `empty`. When there are recipe details, the centered style doesn't look good. 

You need to remove the `empty` class after loading the recipe content.

Fortunatley, you can use HTMX's `hx-on::after-request` attribute to run inline JavaScript to remove the style after the content has loaded.

1. Open `templates/_recipe_list_items.html`.
2. Add the `hx-on` attribute to the detail link:

    ```html title="templates/_recipe_list_items.html" ins={4-5}
    <a href="#"
    hx-get="{{ url_for('recipe_detail', recipe_id=recipe.index) }}"
    hx-target="#recipe-details"
    hx-on::after-request="this.closest('body')
        .querySelector('#recipe-details').classList.remove('empty')">
        {{ recipe.name }}
    </a>
    ```
3. Refresh the page, then select a recipe.

The recipe details should look great now, right! 

:::tip[Learn More]
HTMX provides many more attributes. Check the [HTMX Reference - Core Attributes](https://htmx.org/reference/#attributes).

HTMX also applies a CSS class (`htmx-indicator`) while a request is ongoing — useful for displaying a "Loading..." message.
:::

Next up: Upgrade your app with Live Search Results...
